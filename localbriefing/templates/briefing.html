{% extends 'base.html' %}
{% load format_filters %}

{% block title %}LocalBriefing - 오늘의 브리핑{% endblock %}

{% block content %}
<div class="briefing-header">
    <div class="user-greeting">안녕하세요, <span class="user-name">{{ user_name }}</span>님! 👋</div>
    <div class="location-badge">📍 {{ location }}</div>
    <div class="date-info">{{ date }}</div>
</div>

<!-- Bento Grid Layout -->
<div class="bento-grid">
    <!-- Weather - Large Card -->
    <div class="bento-item weather-large">
        <div class="glass-card">
            <div class="card-header-minimal">
                <span class="weather-icon">☀️</span>
                <span class="card-title-bold">날씨</span>
            </div>
            <div class="weather-display">
                <div class="weather-main-temp">{{ weather.temp }}</div>
                <div class="weather-condition">{{ weather.condition }}</div>
                <div class="weather-dust">미세먼지 {{ weather.dust }}</div>
            </div>
        </div>
    </div>



    <!-- Community Issues - Wide Card -->
    <div class="bento-item community-wide">
        <div class="glass-card">
            <div class="card-header-minimal">
                <span class="clay-icon">💬</span>
                <span class="card-title-bold">동네 이슈</span>
            </div>
            <div class="community-preview">
                {% if local_issues.youtube %}
                    {% for issue in local_issues.youtube %}
                    <div class="issue-item" onclick="window.open('{{ issue.url }}', '_blank')">
                        📺 {{ issue.title|truncatechars:50 }}
                        {% if issue.view_count > 0 %}<span class="view-count">{{ issue.view_count|format_view_count }}</span>{% endif %}
                    </div>
                    {% endfor %}
                {% endif %}
                {% if local_issues.naver_search %}
                    {% for issue in local_issues.naver_search %}
                    <div class="issue-item" onclick="window.open('{{ issue.url }}', '_blank')">
                        🔍 {{ issue.title|truncatechars:50 }}
                    </div>
                    {% endfor %}
                {% endif %}
                {% if local_issues.naver_news %}
                    {% for issue in local_issues.naver_news %}
                    <div class="issue-item" onclick="window.open('{{ issue.url }}', '_blank')">
                        📰 {{ issue.title|truncatechars:50 }}
                    </div>
                    {% endfor %}
                {% endif %}
                {% if not local_issues.youtube and not local_issues.naver_search and not local_issues.naver_news %}
                    <div class="issue-item">🚧 역삼역 근처 공사로 교통 혼잡</div>
                    <div class="issue-item">☕ 새로 생긴 카페 후기 좋음</div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Popular Restaurants - Full Width -->
    <div class="bento-item restaurants-wide">
        <div class="glass-card">
            <div class="card-header-minimal">
                <span class="clay-icon">🍽️</span>
                <span class="card-title-bold">맛집 정보</span>
            </div>
            <div class="restaurant-list">
                {% if popular_restaurants %}
                    {% for restaurant in popular_restaurants %}
                    <div class="restaurant-item" onclick="window.open('{{ restaurant.place_url }}', '_blank')">
                        <div class="restaurant-info">
                            <div class="restaurant-name">{{ restaurant.name }}</div>
                        </div>
                        <div class="restaurant-meta">
                            <span class="restaurant-type">{{ restaurant.category|default:"음식점" }}</span>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="skeleton-item"></div>
                    <div class="skeleton-item"></div>
                    <div class="skeleton-item"></div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- New Restaurants - Full Width -->
    <div class="bento-item new-restaurants-wide">
        <div class="glass-card">
            <div class="card-header-minimal">
                <span class="clay-icon">🆕</span>
                <span class="card-title-bold">신장 개업 음식점</span>
            </div>
            <div class="restaurant-list">
                {% if new_restaurants %}
                    {% for restaurant in new_restaurants %}
                    <div class="restaurant-item" onclick="window.open('https://map.naver.com/v5/search/{{ restaurant.address|urlencode }}', '_blank')">
                        <div class="restaurant-info">
                            <div class="restaurant-name">{{ restaurant.name }}</div>
                            <div class="restaurant-category">{{ restaurant.category|default:"음식점" }}</div>
                        </div>
                        <div class="restaurant-meta">
                            <span class="opening-date">개업일: {{ restaurant.license_date|default:"미상" }}</span>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="skeleton-item"></div>
                    <div class="skeleton-item"></div>
                    <div class="skeleton-item"></div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Quick Actions - Navigation -->
    <div class="bento-item actions-wide">
        <div class="action-buttons">
            <button class="clay-btn secondary" onclick="history.back()">
                <span class="btn-icon">⏮️</span>
                <span>이전 브리핑</span>
            </button>
            <button class="clay-btn primary" onclick="location.href='/settings/'">
                <span class="btn-icon">⚙️</span>
                <span>설정</span>
            </button>
        </div>
    </div>
</div>
{% endblock %}