{% extends 'base.html' %}
{% load format_filters %}

{% block title %}LocalBriefing - ì˜¤ëŠ˜ì˜ ë¸Œë¦¬í•‘{% endblock %}

{% block content %}
<div class="briefing-header">
    <div class="user-greeting">ì•ˆë…•í•˜ì„¸ìš”, <span class="user-name">{{ user_name }}</span>ë‹˜! ğŸ‘‹</div>
    <div class="location-badge">ğŸ“ {{ location }}</div>
    <div class="date-info">{{ date }}</div>
</div>

<!-- Bento Grid Layout -->
<div class="bento-grid">
    <!-- Weather - Large Card -->
    <div class="bento-item weather-large">
        <div class="glass-card">
            <div class="card-header-minimal">
                <span class="weather-icon">â˜€ï¸</span>
                <span class="card-title-bold">ë‚ ì”¨</span>
            </div>
            <div class="weather-display">
                <div class="weather-main-temp">{{ weather.temp }}</div>
                <div class="weather-condition">{{ weather.condition }}</div>
                <div class="weather-dust">ë¯¸ì„¸ë¨¼ì§€ {{ weather.dust }}</div>
            </div>
        </div>
    </div>



    <!-- Community Issues - Wide Card -->
    <div class="bento-item community-wide">
        <div class="glass-card">
            <div class="card-header-minimal">
                <span class="clay-icon">ğŸ’¬</span>
                <span class="card-title-bold">ë™ë„¤ ì´ìŠˆ</span>
            </div>
            <div class="community-preview">
                {% if local_issues.youtube %}
                    {% for issue in local_issues.youtube %}
                    <div class="issue-item" onclick="window.open('{{ issue.url }}', '_blank')">
                        ğŸ“º {{ issue.title|truncatechars:50 }}
                        {% if issue.view_count > 0 %}<span class="view-count">{{ issue.view_count|format_view_count }}</span>{% endif %}
                    </div>
                    {% endfor %}
                {% endif %}
                {% if local_issues.naver_search %}
                    {% for issue in local_issues.naver_search %}
                    <div class="issue-item" onclick="window.open('{{ issue.url }}', '_blank')">
                        ğŸ” {{ issue.title|truncatechars:50 }}
                    </div>
                    {% endfor %}
                {% endif %}
                {% if local_issues.naver_news %}
                    {% for issue in local_issues.naver_news %}
                    <div class="issue-item" onclick="window.open('{{ issue.url }}', '_blank')">
                        ğŸ“° {{ issue.title|truncatechars:50 }}
                    </div>
                    {% endfor %}
                {% endif %}
                {% if not local_issues.youtube and not local_issues.naver_search and not local_issues.naver_news %}
                    <div class="issue-item">ğŸš§ ì—­ì‚¼ì—­ ê·¼ì²˜ ê³µì‚¬ë¡œ êµí†µ í˜¼ì¡</div>
                    <div class="issue-item">â˜• ìƒˆë¡œ ìƒê¸´ ì¹´í˜ í›„ê¸° ì¢‹ìŒ</div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Popular Restaurants - Full Width -->
    <div class="bento-item restaurants-wide">
        <div class="glass-card">
            <div class="card-header-minimal">
                <span class="clay-icon">ğŸ½ï¸</span>
                <span class="card-title-bold">ë§›ì§‘ ì •ë³´</span>
            </div>
            <div class="restaurant-list">
                {% if popular_restaurants %}
                    {% for restaurant in popular_restaurants %}
                    <div class="restaurant-item" onclick="window.open('{{ restaurant.place_url }}', '_blank')">
                        <div class="restaurant-info">
                            <div class="restaurant-name">{{ restaurant.name }}</div>
                        </div>
                        <div class="restaurant-meta">
                            <span class="restaurant-type">{{ restaurant.category|default:"ìŒì‹ì " }}</span>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="skeleton-item"></div>
                    <div class="skeleton-item"></div>
                    <div class="skeleton-item"></div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- New Restaurants - Full Width -->
    <div class="bento-item new-restaurants-wide">
        <div class="glass-card">
            <div class="card-header-minimal">
                <span class="clay-icon">ğŸ†•</span>
                <span class="card-title-bold">ì‹ ì¥ ê°œì—… ìŒì‹ì </span>
            </div>
            <div class="restaurant-list">
                {% if new_restaurants %}
                    {% for restaurant in new_restaurants %}
                    <div class="restaurant-item" onclick="window.open('https://map.naver.com/v5/search/{{ restaurant.address|urlencode }}', '_blank')">
                        <div class="restaurant-info">
                            <div class="restaurant-name">{{ restaurant.name }}</div>
                            <div class="restaurant-category">{{ restaurant.category|default:"ìŒì‹ì " }}</div>
                        </div>
                        <div class="restaurant-meta">
                            <span class="opening-date">ê°œì—…ì¼: {{ restaurant.license_date|default:"ë¯¸ìƒ" }}</span>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="skeleton-item"></div>
                    <div class="skeleton-item"></div>
                    <div class="skeleton-item"></div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Quick Actions - Navigation -->
    <div class="bento-item actions-wide">
        <div class="action-buttons">
            <button class="clay-btn secondary" onclick="history.back()">
                <span class="btn-icon">â®ï¸</span>
                <span>ì´ì „ ë¸Œë¦¬í•‘</span>
            </button>
            <button class="clay-btn primary" onclick="location.href='/settings/'">
                <span class="btn-icon">âš™ï¸</span>
                <span>ì„¤ì •</span>
            </button>
        </div>
    </div>
</div>
{% endblock %}